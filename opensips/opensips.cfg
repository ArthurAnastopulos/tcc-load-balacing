# Arquivo opensips.cfg básico de exemplo

# Definindo variáveis globais
debug=3
log_stderror=no

# Definindo o endereço e porta SIP do OpenSIPS
listen=  udp:0.0.0.0:5060
listen = tcp :0.0.0.0:5060

# Módulo de roteamento de chamadas
route {
    # Rota padrão para encaminhar todas as chamadas SIP
    if (!mf_process_maxfwd_header("10")) {
        sl_send_reply("483","Too Many Hops");
        exit;
    }

    # Encaminhar todas as chamadas para um proxy SIP externo
    if (is_method("INVITE")) {
        t_relay();
        exit;
    }

    # Outros roteamentos podem ser adicionados conforme necessário
}

# Módulo de registro de usuários SIP
modparam("usrloc", "db_mode", 2)
modparam("usrloc", "db_url", "sql://user:password@localhost/opensips")

# Autenticação de usuários SIP
modparam("auth", "usrloc", "db_mode", 2)
modparam("auth", "usrloc", "db_url", "sql://user:password@localhost/opensips")

# Módulo de monitoramento e estatísticas
loadmodule "mi_fifo.so"
modparam("mi_fifo", "fifo_name", "/tmp/opensips_fifo")
modparam("mi_fifo", "fifo_mode", 0666)

# Ativar módulos
loadmodule "proto_udp.so"
loadmodule "usrloc.so"
loadmodule "auth.so"
loadmodule "auth_db.so"
loadmodule "tm.so"

# Configurações do banco de dados PostgreSQL
alias="postgresql"
modparam("db_postgres", "sql_user", "usuario")
modparam("db_postgres", "sql_passwd", "senha")
modparam("db_postgres", "sql_db", "nome_do_banco")
modparam("db_postgres", "sql_host", "localhost")
modparam("db_postgres", "sql_port", 5432)

# Inicialização dos módulos
modinit()
modinit("auth")
modinit("usrloc")

# Escute eventos de chamadas SIP e registre-os no FIFO
event_route[manipulate] {
    xlog("received call\n");
    xlog("callee: $ru\n");
    xlog("caller: $fU\n");
    xlog("calling: $fU\n");
    xlog("uri: $fu\n");
}
